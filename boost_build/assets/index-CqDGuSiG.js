import{b as U,a as se,r as d,j as e,V as t,a3 as Q,c as ae,d as v,g as W,a4 as u,D as O,X as c,Q as Z,L as me,R as ce,G as p,K as pe,a2 as ue,aZ as _,Y as Ee,U as J}from"./index-Bb4T6yJS.js";import{P as fe}from"./container-Mdzkb4R0.js";import{A as Se}from"./helmet-BKDsicQe.js";import{P as xe}from"./breadcrumbs-BoNbTSIP.js";import{A as C}from"./apiErrorResonse-CCtXlH33.js";import{u as te,o as re}from"./yup-VhrNJgti.js";import{c as oe,a as D,b as he}from"./index.esm-B55s2Mzk.js";import{V as E,a as Y}from"./regexRules-CPrFAOdY.js";import{d as Ae}from"./AddAPhoto-D4lISSRu.js";import{d as ie}from"./Send-CIV9xzto.js";import{d as ye}from"./CancelTwoTone-g9I4gqmS.js";import{T as Re}from"./textErrorMessage-CWeXfsj3.js";import{I as z}from"./Iconify-B2ea3Vhk.js";import{S as k}from"./Stack-yqW3PSS6.js";import{T as P}from"./TextField-Dv9saPdb.js";import{I as B}from"./InputAdornment-_AAuA8Z-.js";import{I as G}from"./IconButton-BS36y1hM.js";import{L as q}from"./LoadingButton-D3WD33Li.js";import{C as ee}from"./Card-Cg269qA4.js";import{A as Ie}from"./Avatar-CkCB1SYh.js";import{T as ge}from"./Tooltip-BPIgMGiH.js";import{T as _e}from"./Typography-BvK0EBjx.js";import"./styled-BzESMtjz.js";import"./Breadcrumbs-CYgmF-zU.js";import"./ButtonBase-D0CLtmKS.js";import"./useSlotProps-CkCdCphK.js";import"./createSvgIcon-Cvxe-UMk.js";import"./useId-BQiMa7-Q.js";import"./useControlled-DpDQkWSS.js";import"./Alert-BwGk8Equ.js";import"./index-D8g0v2aH.js";import"./useSlot-KITjY7au.js";import"./iconify-C-ngdJty.js";import"./Box-B1asL3_Y.js";import"./createBox-Z02cO3O7.js";import"./Select-D_KZ1HKa.js";import"./useFormControl-oNyqkk4W.js";import"./Popover-_oog1cCQ.js";import"./Modal-BEZPFFVa.js";import"./Portal-DOJFZdR8.js";import"./Grow-BLrRft-L.js";import"./List-BGusPRli.js";import"./FormHelperText-D8o68a4M.js";import"./Button-CoPqx7My.js";import"./Popper-BrZsYCFQ.js";const Pe=oe().shape({password:D().required(E.PASSWORD.REQUIRED).matches(Y.PASSWORD,E.PASSWORD.REGEX_RULES),oldpassword:D().required(E.OLD_PASSWORD.REQUIRED).matches(Y.PASSWORD,E.PASSWORD.REGEX_RULES.replace("Password","Old password")),confirmPassword:D().required(E.CONFIRMED_PASSWORD.REQUIRED).oneOf([he("password")],E.CONFIRMED_PASSWORD.NOT_IDENTICAL)});function Le(s){U(f=>f.customization);const{loader:i,message:S,messageType:r}=U(f=>f.request),A=se(),[L,y]=d.useState(!1),[R,V]=d.useState(!1),[I,N]=d.useState(!1);d.useState(!1);const[H,ne]=d.useState(""),{register:n,handleSubmit:F,reset:K,formState:x}=te({mode:"onTouched",resolver:re(Pe)}),{errors:o}=x,$=async f=>{const b=O.LOCALE;A({type:t.INIT_LOADER,payload:{loader:!0}});try{const j=await Q(ae.UPDATE_PASSWORD,{old_password:f.oldpassword,new_password:f.password}),{status:M,data:{message:a}}=j;M===v[200]?(K(),s.cancel(),A({type:t.SUCCESS,payload:{message:W[b].RESET_PASS_SUCCESS}}),u.success(a)):(A({type:t.FAILURE,payload:{message:W[b].RESET_PASS_FAILED}}),u.error(a))}catch(j){A({type:t.FAILURE,payload:{message:C(j)}})}};return e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:F($),noValidate:!0,children:e.jsxs(k,{children:[e.jsx(Re,{message:H}),e.jsxs(k,{children:[e.jsx(P,{sx:{my:1},...n("oldpassword"),name:"oldpassword",label:"Old password",type:R?"text":"password",error:!!o.oldpassword,helperText:o.oldpassword?o.oldpassword.message:"",InputProps:{endAdornment:e.jsx(B,{position:"end",children:e.jsx(G,{onClick:()=>V(!R),edge:"end",children:e.jsx(z,{icon:R?"eva:eye-fill":"eva:eye-off-fill"})})})}}),e.jsx(P,{sx:{my:1},...n("password"),name:"password",autoComplete:"true",label:"Password",type:L?"text":"password",error:!!o.password,helperText:o.password?o.password.message:"",InputProps:{endAdornment:e.jsx(B,{position:"end",children:e.jsx(G,{onClick:()=>y(!L),edge:"end",children:e.jsx(z,{icon:L?"eva:eye-fill":"eva:eye-off-fill"})})})}}),e.jsx(P,{sx:{my:1},...n("confirmPassword"),type:I?"text":"password",name:"confirmPassword",label:"Confirm password",autoComplete:"true",error:!!o.confirmPassword,helperText:o.confirmPassword?o.confirmPassword.message:"",InputProps:{endAdornment:e.jsx(B,{position:"end",children:e.jsx(G,{onClick:()=>N(!I),edge:"end",children:e.jsx(z,{icon:I?"eva:eye-fill":"eva:eye-off-fill"})})})}})]}),e.jsxs(k,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",sx:{my:3},children:[e.jsxs(q,{size:"medium",disabled:i,type:"button",variant:"outlined",onClick:i?()=>!1:s.cancel,children:[" ","Cancel"]}),e.jsx(q,{size:"medium",type:"submit",variant:"contained",loadingPosition:"end",endIcon:e.jsx(ie,{}),loading:i,children:e.jsx("span",{children:"Reset password"})})]})]})})})}const je=oe().shape({firstName:D().required("First name is required").matches(Y.NAME,E.NAME.REGEX_RULES).max(30,E.NAME.MAX_LENGTH),lastName:D().required("Last name is required").max(30,E.NAME.MAX_LENGTH)});function As(){var M;const s=se(),i=U(a=>a.customization),{loader:S}=U(a=>a.request),r=U(a=>a.auth),A=r[c.NAME],L=r[c.EMAIL],y=r[c.PROFILE_PICTURE],[R,V]=d.useState(!1),I=d.useRef(),{register:N,handleSubmit:H,setValue:ne,formState:{errors:n}}=te({mode:"onTouched",resolver:re(je),defaultValues:{firstName:r[c.FIRST_NAME],lastName:r[c.LAST_NAME]}});d.useState({phone:r.phone||"",isoCode:((M=r.country_code_iso)==null?void 0:M.toLowerCase())||O.COUNTRY_ISO,dialCode:r.country_code||O.COUNTRY_DIAL_CODE});const F=()=>{V(!R)},[K,x]=d.useState(!1),o=()=>{x(!0)},$=()=>{S||x(!1)},f=async a=>{const l=O.LOCALE,h={...a};s({type:t.INIT_LOADER,payload:{loader:!0}});try{const m=await Q(ae.UPDATE_PROFILE,h),{status:g}=m,{success:X,message:w}=m.data;if(g===v[200]&&X){let T={...r,[c.FIRST_NAME]:a.firstName,[c.LAST_NAME]:a.lastName};s({type:_.UPDATE_PROFILE,payload:T,index:_.UPDATE_PROFILE}),s({type:t.SUCCESS,payload:{message:w}}),u.success(w)}else s({type:t.FAILURE,payload:{message:W[l].PROFILE_UPLOAD_FAILED}}),u.error(w)}catch(m){s({type:t.FAILURE,payload:{message:C(m)}}),u.error(m)}},b=async()=>{let a;try{s({type:t.INIT_LOADER,payload:{loader:!0}});const{status:l,data:{message:h}}=await Ee(J.REMOVE_USER_PROFILE_IMAGE,{user_id:r.id});if(l===v[200]){let m={...r,[c.PROFILE_PICTURE]:null};s({type:_.UPDATE_PROFILE,payload:m,index:_.UPDATE_PROFILE}),s({type:t.SUCCESS,payload:{message:h}}),u.success(h)}else s({type:t.FAILURE,payload:{message:C()}}),u.error(h)}catch(l){a=C(l),s({type:t.FAILURE,payload:{message:a}})}},j=async a=>{let l=new FormData;const h=a.target.files[0];l.append("profile_image",h),l.append("user_id",r.id);const m=O.LOCALE;s({type:t.INIT_LOADER,payload:{loader:!0}});try{const g=await Q(J.UPDATE_USER_PROFILE_IMAGE,l),{status:X}=g,{success:w,message:T,data:{image_url:de}}=g.data;if(X===v[200]&&w){let le={...r,[c.PROFILE_PICTURE]:de};s({type:_.UPDATE_PROFILE,payload:le,index:_.UPDATE_PROFILE}),s({type:t.SUCCESS,payload:{message:T}}),x(!1),u.success(T)}else s({type:t.FAILURE,payload:{message:W[m].PROFILE_UPLOAD_FAILED}}),x(!1),u.error(T)}catch(g){x(!1),s({type:t.FAILURE,payload:{message:C(g)}})}};return d.useEffect(()=>{s({type:t.INIT})},[]),e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:Z.SETTING}),e.jsxs(fe,{className:"page-container users-page",heading:Z.SETTING,children:[e.jsx(xe,{breadcrumbs:[e.jsx(me,{style:{color:"rgb(99, 115, 129)",textDecoration:"none"},to:ce.DASHBOARD,children:"dashboard"}),"Account settings"]}),e.jsxs(p,{container:!0,direction:"row",justifyContent:"space-between",alignItems:"flex-start",spacing:2,children:[e.jsx(p,{item:!0,md:4,children:e.jsx(ee,{className:`${(i==null?void 0:i.navType)==="dark"?"dark_card":""} profile-left-section`,sx:{px:4,py:6,overflow:"hidden",boxShadow:1},children:e.jsxs(p,{container:!0,direction:"column",justifyContent:"center",alignItems:"center",children:[e.jsxs("div",{onMouseEnter:o,onMouseLeave:$,style:{position:"relative"},children:[e.jsx(Ie,{alt:A,sx:{width:120,height:120,border:y===null?"2px dashed #3273ba":"none"},src:y}),y!==null?e.jsx(ge,{placement:"top",title:"Click to remove profile picture",children:e.jsx(ye,{sx:{color:pe.ERROR_MSG_COLOR,position:"absolute",top:0,right:"20px",cursor:"pointer",fontSize:"18px",background:"#fff",borderRadius:"50%"},onClick:b})}):"",!y&&e.jsx("div",{style:{position:"absolute",top:"33%",right:"33%"},children:e.jsx(G,{onClick:()=>S?!1:I.current.click(),children:S?e.jsx(ue,{}):e.jsx(Ae,{})})}),e.jsx("input",{ref:I,type:"file",accept:"image/*",onChange:j,style:{display:"none"}})]}),e.jsx(_e,{sx:{px:5,py:1,textAlign:"center",color:"#637381"},variant:"body2",children:"Allowed *.jpeg, *.jpg, *.png, *.gif max size of 3 MB"})]})})}),e.jsx(p,{item:!0,md:8,children:e.jsx(ee,{className:`${(i==null?void 0:i.navType)==="dark"?"dark_card":""} profile-right-section`,sx:{px:4,py:5,overflow:"hidden",boxShadow:1},children:R?e.jsx(p,{item:!0,md:12,children:e.jsx(Le,{cancel:F})}):e.jsxs("form",{onSubmit:H(f),noValidate:!0,children:[e.jsxs(p,{container:!0,spacing:3,mb:3,children:[e.jsx(p,{item:!0,md:12,children:e.jsx(P,{label:"Email",name:"Email",value:L,disabled:!0,fullWidth:!0})}),e.jsx(p,{item:!0,md:6,children:e.jsx(P,{...N("firstName"),error:!!n.firstName,label:"First Name",helperText:n.firstName?n.firstName.message:"",name:"firstName",fullWidth:!0})}),e.jsxs(p,{item:!0,md:6,children:[" ",e.jsx(P,{...N("lastName"),error:!!n.lastName,label:"Last Name",helperText:n.lastName?n.lastName.message:"",name:"lastName",fullWidth:!0})]})]}),e.jsxs(k,{direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",sx:{mt:3},children:[e.jsx(q,{loading:!!S,size:"medium",type:"button",variant:"outlined",onClick:F,children:"Update password"}),e.jsx(q,{loading:!!S,size:"medium",type:"submit",loadingPosition:"end",endIcon:e.jsx(ie,{}),variant:"contained",children:S?"Please Wait...":"save changes"})]})]})})})]})]})]})}export{As as default};
